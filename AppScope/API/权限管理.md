# 应用权限管控
应用权限保护的对象可以分为数据和功能：
数据包括个人数据（如照片、通讯录、日历、位置等）、设备数据（如设备标识、相机、麦克风等）。
功能包括设备功能（如访问摄像头/麦克风、打电话、联网等）、应用功能（如弹出悬浮窗、创建快捷方式等）。

## 权限使用的基本原则
应用（包括应用引用的三方库）所需权限必须在应用的配置文件中严格按照权限开发指导逐个声明。(module.json5配置文件的requestPermissions标签中声明权限)
权限申请满足最小化原则，禁止申请非必要的、已废弃的权限。
应用申请敏感权限时，必须填写权限使用理由字段，敏感权限通常是指与用户隐私密切相关的权限，包括地理位置、相机、麦克风、日历、健身运动、身体传感器、音乐、文件、图片视频等权限。
应用敏感权限须在对应业务功能执行前动态申请，满足隐私最小化要求。
用户拒绝授予某个权限后，应用与此权限无关的其他业务功能应允许正常使用。


## 授权方式
**system_grant（系统授权）**  系统授权类型(数据不会涉及到用户或设备的敏感信息)
**user_grant（用户授权）** 用户授权类型(数据将会涉及到用户或设备的敏感信息)

## 权限机制中的基本概念
TokenID(作为应用的唯一标识)
APL等级 :元能力权限等级APL指的是应用的权限申请优先级的定义，不同APL等级的应用能够申请的权限等级不同。
应用APL等级:

| APL级别      | 说明                                                         |
| :----------- | :----------------------------------------------------------- |
| normal       | 默认情况下，应用的APL等级都为normal等级。                    |
| system_basic | 该等级的应用服务提供系统基础服务。                           |
| system_core  | 该等级的应用服务提供操作系统核心能力。应用APL等级不允许配置为system_core。 |



**权限APL等级**

| APL级别      | 说明                                                         | 开放范围                                                     |
| :----------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| normal       | 允许应用访问超出默认规则外的普通系统资源，如配置Wi-Fi信息、调用相机拍摄等。这些系统资源的开放（包括数据和功能）对用户隐私以及其他应用带来的风险低。 | APL等级为normal及以上的应用。                                |
| system_basic | 允许应用访问操作系统基础服务（系统提供或者预置的基础功能）相关的资源，如系统设置、身份认证等。这些系统资源的开放对用户隐私以及其他应用带来的风险较高。 | - APL等级为system_basic及以上的应用。- 部分权限对normal级别的应用受限开放，这部分权限在本指导中描述为“受限开放权限”。 |
| system_core  | 涉及开放操作系统核心资源的访问操作。这部分系统资源是系统最核心的底层服务，如果遭受破坏，操作系统将无法正常运行。 | - APL等级为system_core的应用。- 仅对系统应用开               |



## 应用申请权限的方式

| 权限类型       | 授权方式     | 操作路径                                                |
| :------------- | :----------- | :------------------------------------------------------ |
| 所有应用可申请 | system_grant | 声明权限 > 访问接口                                     |
| 所有应用可申请 | user_grant   | 声明权限 > 向用户申请授权 > 访问接口                    |
| 受限开放权限   | system_grant | 申请使用受限权限 > 声明权限 > 访问接口                  |
| 受限开放权限   | user_grant   | 申请使用受限权限 > 声明权限 > 向用户申请授权 > 访问接口 |

## 在配置文件中声明权限(module.json5配置文件的requestPermissions标签)

| 属性      | 含义                                                         | 数据类型 | 取值范围                                                     |
| :-------- | :----------------------------------------------------------- | :------- | :----------------------------------------------------------- |
| name      | 需要使用的权限名称。                                         | 字符串   | **必填**，需为系统已定义的权限                               |
| reason    | 申请权限的原因。                                             | 字符串   | **可选填写**，该字段用于应用上架校验，当申请的权限为user_grant权限时必填，并且需要进行多语种适配。使用string类资源引用。格式为$string: ***。 |
| usedScene | 权限使用的场景，该字段用于应用上架校验。包括abilities和when两个子项。- abilities：使用权限的UIAbility或者ExtensionAbility组件的名称。- when：调用时机。 | 对象     | usedScene**必填**。- abilities：**可选填写**，可以配置为多个UIAbility或者ExtensionAbility名称的字符串数组。- when：**可选填写**，但如果配置此字段，只能填入固定值inuse（使用时）、always（始终），不能为空。当申请的权限为user_grant权限时建议填写。 |

## 向用户申请授权

当应用申请user_grant权限时，需要完成以下步骤：

1. 在配置文件中，声明应用需要请求的权限。
2. 将应用中需要申请权限的目标对象与对应目标权限进行关联，让用户明确地知道，哪些操作需要用户向应用授予指定的权限。
3. 运行应用时，在用户触发访问操作目标对象时应该调用接口，精准触发动态授权弹框。该接口的内部会检查当前用户是否已经授权应用所需的权限，如果当前用户尚未授予应用所需的权限，该接口会拉起动态授权弹框，向用户请求授权。
4. 检查用户的授权结果，确认用户已授权才可以进行下一步操作。